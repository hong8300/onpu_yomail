# Onpu Project - 開発ステータス

## 📊 プロジェクト概要
**Onpu** は楽譜学習支援Webアプリケーションです。音符を見て瞬時に音名を答える練習ができ、楽譜読解力の向上を目指しています。

## ✅ 実装完了機能

### 🎼 楽譜表示システム
- **双譜表表示**: ト音記号・ヘ音記号を同時表示
- **VexFlow統合**: プロ品質の楽譜レンダリング
- **レスポンシブ対応**: 画面サイズに応じた自動調整
- **音符ハイライト**: 対象音符を赤色で明示

### 🎹 入力システム
- **MIDI キーボード対応**: リアルタイム入力処理
- **ピアノ鍵盤UI**: マルチオクターブ表示（1-4オクターブ）
- **PCキーボード**: C-Bキーでの入力
- **マウスクリック**: 鍵盤クリックでの入力

### ⚙️ 設定・カスタマイズ
- **音域プリセット**: 
  - 初心者 (C4-C5): 2オクターブ
  - 中級 (C3-C6): 4オクターブ  
  - カスタム: 任意設定
- **問題数**: 10-100問
- **オクターブ判定**: 正確なオクターブでの回答要求
- **シャープ・フラット**: 黒鍵の有効/無効切り替え

### 🎵 音響機能
- **音符再生**: Web Audio APIによる音生成
- **正解音**: 正確な周波数での音符再生
- **不正解ブザー**: 間違い時の音響フィードバック

### 📊 学習管理
- **セッション記録**: 練習履歴の自動保存
- **統計表示**: 正解率・応答時間・進捗
- **データポータビリティ**: JSON形式エクスポート/インポート

### 🎨 UI/UX
- **ダークモード**: 完全対応（楽譜エリアは白背景維持）
- **レスポンシブデザイン**: モバイル・タブレット対応
- **Shadcn UI**: モダンなUIコンポーネント

## 🛠️ 技術スタック

### フロントエンド
- **Next.js 15** (App Router)
- **React 18** + TypeScript
- **Tailwind CSS** + Shadcn UI
- **Vexflow** (楽譜レンダリング)

### データ管理
- **LocalStorage**: 設定・履歴データ
- **SessionStorage**: MIDI接続状態
- **React Context**: グローバル状態管理

### 外部API
- **Web MIDI API**: MIDIキーボード統合
- **Web Audio API**: 音響機能

## 📂 アーキテクチャ

### ディレクトリ構造
```
onpu-next/
├── app/                    # Next.js App Router
│   ├── practice/          # 練習画面
│   ├── settings/          # 設定画面
│   └── history/           # 履歴画面
├── components/            # React コンポーネント
│   ├── music/             # 楽譜・音楽関連
│   ├── midi/              # MIDI統合
│   ├── providers/         # Context プロバイダー
│   └── ui/                # Shadcn UI
├── hooks/                 # カスタムフック
└── lib/                   # ユーティリティ・型定義
```

### 主要コンポーネント
- **VexflowMultipleNotes**: 双譜表楽譜表示
- **PianoKeyboard**: マルチオクターブ鍵盤
- **MidiProvider**: MIDI状態管理
- **ThemeProvider**: ダークモード管理

## 🔧 開発・ビルドコマンド

```bash
# 開発サーバー起動
npm run dev

# 本番ビルド
npm run build

# 本番サーバー起動  
npm start

# コード品質チェック
npm run lint
```

## 🎯 最新の重要更新

### 2025年8月: 楽譜表示・鍵盤機能の大幅強化
- **双譜表表示**: ト音記号とヘ音記号を同時表示
- **音域プリセット刷新**: C4-C5（初心者）、C3-C6（中級）  
- **マルチオクターブ鍵盤**: 音域に応じた1-4オクターブ表示
- **オクターブ判定機能**: 正確なオクターブでの回答を要求

### 技術的改善
- VexflowMultipleNotesの双譜表対応
- PianoKeyboardの動的オクターブ表示
- 設定システムの音域プリセット最適化

## 🚀 動作確認済み環境

### ブラウザ対応
- ✅ **Chrome** (推奨・MIDI対応)
- ✅ **Edge** (MIDI対応)
- ✅ **Opera** (MIDI対応)
- ❌ **Firefox** (MIDI非対応)
- ❌ **Safari** (MIDI非対応)

### デバイス対応
- ✅ **Desktop PC** (Windows/Mac/Linux)
- ✅ **タブレット** (iPad/Android)
- ✅ **モバイル** (iPhone/Android) ※MIDI除く

## 📋 今後の拡張予定

### 短期目標
- [ ] 和音練習モード
- [ ] 聴音練習機能
- [ ] PWA対応（オフライン利用）

### 中期目標  
- [ ] 音楽教師向け管理機能
- [ ] より詳細な学習分析
- [ ] 多言語対応（英語・韓国語等）

### 長期目標
- [ ] クラウド同期機能
- [ ] オンライン対戦機能
- [ ] モバイルアプリ化

## 🔍 開発者向け注意事項

### 重要な実装パターン
- **Vexflow**: 動的インポート必須（SSR回避）
- **MIDI状態**: SessionStorageで永続化
- **ダークモード**: 楽譜エリアは白背景維持
- **テスト**: `npm run lint` + `npm run build` 必須

### デバッグポイント
- MIDI問題: SessionStorage + Console確認
- 楽譜表示: Vexflowエラー確認
- 状態管理: React DevTools使用

## 📄 ライセンス

**MIT License** - 商用・非商用利用可能、改変・再配布可能

## 📞 サポート

- **GitHub Issues**: バグ報告・機能要求
- **GitHub Discussions**: 一般的な質問・議論

---

**最終更新**: 2025年8月14日  
**開発状況**: メイン機能完成・継続的な機能追加フェーズ  
**次回予定**: GitHub リポジトリ公開準備完了